<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Experiment Variant Component - Test</title>
  <style>
    body {
      font-family: system-ui, -apple-system, sans-serif;
      max-width: 1200px;
      margin: 0 auto;
      padding: 2rem;
      background: #f5f5f5;
    }

    .test-section {
      background: white;
      padding: 2rem;
      margin-bottom: 2rem;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    h1 {
      color: #333;
      border-bottom: 3px solid #007bff;
      padding-bottom: 0.5rem;
    }

    h2 {
      color: #555;
      margin-top: 0;
    }

    .controls {
      display: flex;
      gap: 1rem;
      margin-bottom: 1rem;
      flex-wrap: wrap;
    }

    button {
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 4px;
      background: #007bff;
      color: white;
      cursor: pointer;
      font-size: 14px;
    }

    button:hover {
      background: #0056b3;
    }

    button.secondary {
      background: #6c757d;
    }

    button.secondary:hover {
      background: #545b62;
    }

    .variant-content {
      padding: 1rem;
      border-radius: 4px;
      margin: 1rem 0;
    }

    .control-variant {
      background: #e9ecef;
      border: 2px solid #6c757d;
    }

    .variant-a {
      background: #cce5ff;
      border: 2px solid #007bff;
    }

    .variant-b {
      background: #d4edda;
      border: 2px solid #28a745;
    }

    .variant-c {
      background: #fff3cd;
      border: 2px solid #ffc107;
    }

    .status {
      padding: 0.5rem;
      background: #f8f9fa;
      border-left: 4px solid #007bff;
      margin: 1rem 0;
      font-family: monospace;
      font-size: 14px;
    }

    .event-log {
      background: #1e1e1e;
      color: #d4d4d4;
      padding: 1rem;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      max-height: 200px;
      overflow-y: auto;
    }

    .event-log-entry {
      margin: 0.25rem 0;
      padding: 0.25rem;
      border-left: 2px solid #007bff;
      padding-left: 0.5rem;
    }

    .event-log-entry.variant-change {
      border-left-color: #28a745;
    }

    code {
      background: #f8f9fa;
      padding: 0.2rem 0.4rem;
      border-radius: 3px;
      font-size: 0.9em;
    }
  </style>
</head>
<body>
  <h1>üß™ Experiment Variant Component - Test Suite</h1>

  <!-- Test 1: Basic Variant Rendering -->
  <div class="test-section">
    <h2>Test 1: Basic Variant Rendering</h2>
    <p>Tests basic variant switching with control and two variants.</p>
    
    <div class="controls">
      <button onclick="setVariant('test-1', 'control')">Show Control</button>
      <button onclick="setVariant('test-1', 'a')">Show Variant A</button>
      <button onclick="setVariant('test-1', 'b')">Show Variant B</button>
    </div>

    <experiment-variant id="exp-1" experiment-id="test-1" default-variant="control">
      <div slot="control" class="variant-content control-variant">
        <strong>Control Variant</strong>
        <p>This is the original control version.</p>
      </div>
      <div slot="variant-a" class="variant-content variant-a">
        <strong>Variant A</strong>
        <p>This is the first experimental variant.</p>
      </div>
      <div slot="variant-b" class="variant-content variant-b">
        <strong>Variant B</strong>
        <p>This is the second experimental variant.</p>
      </div>
    </experiment-variant>

    <div class="status" id="status-1">
      Current Variant: <span id="current-variant-1">-</span>
    </div>
  </div>

  <!-- Test 2: Multiple Variants -->
  <div class="test-section">
    <h2>Test 2: Multiple Variants (A/B/C/D Test)</h2>
    <p>Tests rendering with more than two variants.</p>
    
    <div class="controls">
      <button onclick="setVariant('test-2', 'control')">Control</button>
      <button onclick="setVariant('test-2', 'a')">Variant A</button>
      <button onclick="setVariant('test-2', 'b')">Variant B</button>
      <button onclick="setVariant('test-2', 'c')">Variant C</button>
    </div>

    <experiment-variant id="exp-2" experiment-id="test-2" default-variant="control">
      <div slot="control" class="variant-content control-variant">
        <h3>üéØ Control</h3>
        <p>Standard button: <button>Click Me</button></p>
      </div>
      <div slot="variant-a" class="variant-content variant-a">
        <h3>üîµ Variant A - Blue Theme</h3>
        <p>Blue button: <button style="background: #007bff;">Click Me</button></p>
      </div>
      <div slot="variant-b" class="variant-content variant-b">
        <h3>üü¢ Variant B - Green Theme</h3>
        <p>Green button: <button style="background: #28a745;">Click Me</button></p>
      </div>
      <div slot="variant-c" class="variant-content variant-c">
        <h3>üü° Variant C - Yellow Theme</h3>
        <p>Yellow button: <button style="background: #ffc107; color: #000;">Click Me</button></p>
      </div>
    </experiment-variant>

    <div class="status" id="status-2">
      Current Variant: <span id="current-variant-2">-</span>
    </div>
  </div>

  <!-- Test 3: Dynamic Content -->
  <div class="test-section">
    <h2>Test 3: Dynamic Content Updates</h2>
    <p>Tests that variant components can contain dynamic content.</p>
    
    <div class="controls">
      <button onclick="setVariant('test-3', 'control')">Control</button>
      <button onclick="setVariant('test-3', 'a')">Variant A</button>
      <button class="secondary" onclick="updateDynamicContent()">Update Content</button>
    </div>

    <experiment-variant id="exp-3" experiment-id="test-3" default-variant="control">
      <div slot="control" class="variant-content control-variant">
        <strong>Control - Static Content</strong>
        <p id="dynamic-control">Initial content</p>
      </div>
      <div slot="variant-a" class="variant-content variant-a">
        <strong>Variant A - Dynamic Content</strong>
        <p id="dynamic-variant">Initial content</p>
      </div>
    </experiment-variant>

    <div class="status" id="status-3">
      Current Variant: <span id="current-variant-3">-</span>
    </div>
  </div>

  <!-- Test 4: Event Tracking -->
  <div class="test-section">
    <h2>Test 4: Event Tracking</h2>
    <p>Tests that variant-change events are properly dispatched.</p>
    
    <div class="controls">
      <button onclick="setVariant('test-4', 'control')">Control</button>
      <button onclick="setVariant('test-4', 'a')">Variant A</button>
      <button onclick="setVariant('test-4', 'b')">Variant B</button>
      <button class="secondary" onclick="clearEventLog()">Clear Log</button>
    </div>

    <experiment-variant id="exp-4" experiment-id="test-4" default-variant="control">
      <div slot="control" class="variant-content control-variant">Control Version</div>
      <div slot="variant-a" class="variant-content variant-a">Variant A Version</div>
      <div slot="variant-b" class="variant-content variant-b">Variant B Version</div>
    </experiment-variant>

    <div class="event-log" id="event-log"></div>
  </div>

  <!-- Test 5: Fallback Behavior -->
  <div class="test-section">
    <h2>Test 5: Fallback Behavior</h2>
    <p>Tests fallback when assigned variant doesn't exist.</p>
    
    <div class="controls">
      <button onclick="setVariant('test-5', 'control')">Control (exists)</button>
      <button onclick="setVariant('test-5', 'nonexistent')">Nonexistent Variant</button>
    </div>

    <experiment-variant id="exp-5" experiment-id="test-5" 
                       default-variant="control" 
                       fallback-variant="control">
      <div slot="control" class="variant-content control-variant">
        <strong>Control / Fallback</strong>
        <p>This shows when variant doesn't exist.</p>
      </div>
      <div slot="variant-a" class="variant-content variant-a">
        <strong>Variant A</strong>
        <p>This variant exists.</p>
      </div>
    </experiment-variant>

    <div class="status" id="status-5">
      Current Variant: <span id="current-variant-5">-</span>
    </div>
  </div>

  <!-- Mock Experiment Context -->
  <script type="module">
    /**
     * Mock Experiment Context for testing
     * Simulates the real ExperimentContext API
     */
    class MockExperimentContext {
      constructor() {
        this.state = {
          experiments: {}
        };
        this.subscribers = new Set();
      }

      subscribe(callback) {
        this.subscribers.add(callback);
        // Return unsubscribe function
        return () => {
          this.subscribers.delete(callback);
        };
      }

      getState() {
        return this.state;
      }

      setVariant(experimentId, variant) {
        this.state.experiments[experimentId] = {
          id: experimentId,
          assignedVariant: variant,
          timestamp: Date.now()
        };
        
        // Notify subscribers
        this.subscribers.forEach(callback => {
          callback(this.state);
        });
      }

      removeExperiment(experimentId) {
        delete this.state.experiments[experimentId];
        this.subscribers.forEach(callback => {
          callback(this.state);
        });
      }
    }

    // Create global mock context
    window.ExperimentContext = new MockExperimentContext();
  </script>

  <!-- Import Component -->
  <script type="module">
    import './experiment-variant.js';

    // Setup event listeners for all variant components
    document.querySelectorAll('experiment-variant').forEach((component, index) => {
      const testNum = index + 1;
      
      component.addEventListener('variant-change', (event) => {
        const { experimentId, variant, timestamp } = event.detail;
        
        // Update status display
        const statusSpan = document.getElementById(`current-variant-${testNum}`);
        if (statusSpan) {
          statusSpan.textContent = variant;
        }

        // Log event for test 4
        if (testNum === 4) {
          logEvent('variant-change', event.detail);
        }

        console.log(`[Test ${testNum}] Variant changed:`, event.detail);
      });
    });

    // Make test functions globally available
    window.setVariant = function(experimentId, variant) {
      window.ExperimentContext.setVariant(experimentId, variant);
    };

    window.updateDynamicContent = function() {
      const timestamp = new Date().toLocaleTimeString();
      document.getElementById('dynamic-control').textContent = `Updated at ${timestamp}`;
      document.getElementById('dynamic-variant').textContent = `Updated at ${timestamp}`;
    };

    window.clearEventLog = function() {
      document.getElementById('event-log').innerHTML = '';
    };

    window.logEvent = function(type, detail) {
      const log = document.getElementById('event-log');
      const entry = document.createElement('div');
      entry.className = `event-log-entry ${type}`;
      entry.textContent = `[${new Date().toLocaleTimeString()}] ${type}: ${JSON.stringify(detail)}`;
      log.appendChild(entry);
      log.scrollTop = log.scrollHeight;
    };

    console.log('‚úÖ Experiment Variant Component tests loaded');
    console.log('üìù Use browser DevTools to inspect component behavior');
  </script>
</body>
</html>