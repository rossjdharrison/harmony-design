{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://harmonydesign.dev/schemas/cross-graph-edge.json",
  "title": "Cross-Graph Edge Definition",
  "description": "Schema for defining edges that connect nodes across different bounded context graphs, enabling reactive data flow between autonomous subsystems.",
  "type": "object",
  "required": ["id", "sourceGraph", "sourceNode", "sourcePort", "targetGraph", "targetNode", "targetPort", "edgeType"],
  "properties": {
    "id": {
      "type": "string",
      "description": "Unique identifier for this cross-graph edge",
      "pattern": "^[a-z0-9-]+$",
      "minLength": 1,
      "maxLength": 128
    },
    "sourceGraph": {
      "type": "string",
      "description": "Bounded context graph containing the source node",
      "enum": ["audio-bc", "sequencer-bc", "mixer-bc", "ui-bc", "project-bc", "export-bc"],
      "examples": ["audio-bc", "sequencer-bc"]
    },
    "sourceNode": {
      "type": "string",
      "description": "Node ID within the source graph",
      "minLength": 1,
      "maxLength": 128
    },
    "sourcePort": {
      "type": "string",
      "description": "Output port name on the source node",
      "minLength": 1,
      "maxLength": 64
    },
    "targetGraph": {
      "type": "string",
      "description": "Bounded context graph containing the target node",
      "enum": ["audio-bc", "sequencer-bc", "mixer-bc", "ui-bc", "project-bc", "export-bc"],
      "examples": ["ui-bc", "mixer-bc"]
    },
    "targetNode": {
      "type": "string",
      "description": "Node ID within the target graph",
      "minLength": 1,
      "maxLength": 128
    },
    "targetPort": {
      "type": "string",
      "description": "Input port name on the target node",
      "minLength": 1,
      "maxLength": 64
    },
    "edgeType": {
      "type": "string",
      "description": "Type of cross-graph connection",
      "enum": ["event", "data", "control", "state-sync"],
      "examples": ["event", "data"]
    },
    "dataType": {
      "type": "string",
      "description": "Data type flowing through this edge",
      "enum": ["f32", "f64", "i32", "u32", "bool", "string", "buffer", "event", "json"],
      "examples": ["f32", "event"]
    },
    "bufferSize": {
      "type": "integer",
      "description": "Buffer size in bytes for data edges (required for buffer type)",
      "minimum": 1,
      "maximum": 1048576,
      "examples": [128, 512, 2048]
    },
    "latencyBudget": {
      "type": "number",
      "description": "Maximum acceptable latency in milliseconds",
      "minimum": 0,
      "maximum": 1000,
      "examples": [10, 16, 33]
    },
    "priority": {
      "type": "string",
      "description": "Scheduling priority for this edge",
      "enum": ["critical", "high", "normal", "low"],
      "default": "normal"
    },
    "transform": {
      "type": "object",
      "description": "Optional transformation applied to data crossing this edge",
      "properties": {
        "type": {
          "type": "string",
          "enum": ["map", "filter", "throttle", "debounce", "sample"],
          "description": "Type of transformation"
        },
        "config": {
          "type": "object",
          "description": "Configuration specific to the transform type",
          "additionalProperties": true
        }
      },
      "required": ["type"]
    },
    "validation": {
      "type": "object",
      "description": "Validation rules for data crossing this edge",
      "properties": {
        "required": {
          "type": "boolean",
          "description": "Whether data must be present",
          "default": true
        },
        "range": {
          "type": "object",
          "description": "Numeric range validation",
          "properties": {
            "min": {
              "type": "number"
            },
            "max": {
              "type": "number"
            }
          }
        },
        "pattern": {
          "type": "string",
          "description": "Regex pattern for string validation"
        }
      }
    },
    "metadata": {
      "type": "object",
      "description": "Additional metadata for tooling and debugging",
      "properties": {
        "label": {
          "type": "string",
          "description": "Human-readable label"
        },
        "description": {
          "type": "string",
          "description": "Detailed description of this edge's purpose"
        },
        "color": {
          "type": "string",
          "description": "Visual color hint for graph visualization",
          "pattern": "^#[0-9A-Fa-f]{6}$"
        },
        "tags": {
          "type": "array",
          "description": "Tags for categorization",
          "items": {
            "type": "string"
          }
        }
      }
    },
    "monitoring": {
      "type": "object",
      "description": "Performance monitoring configuration",
      "properties": {
        "enabled": {
          "type": "boolean",
          "default": false
        },
        "sampleRate": {
          "type": "number",
          "description": "Fraction of messages to monitor (0.0 to 1.0)",
          "minimum": 0,
          "maximum": 1
        },
        "metrics": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["latency", "throughput", "errors", "dropped"]
          }
        }
      }
    }
  },
  "allOf": [
    {
      "if": {
        "properties": {
          "dataType": {
            "const": "buffer"
          }
        }
      },
      "then": {
        "required": ["bufferSize"]
      }
    },
    {
      "if": {
        "properties": {
          "edgeType": {
            "const": "control"
          }
        }
      },
      "then": {
        "required": ["latencyBudget"]
      }
    }
  ],
  "examples": [
    {
      "id": "audio-to-ui-level-meter",
      "sourceGraph": "audio-bc",
      "sourceNode": "master-output",
      "sourcePort": "level",
      "targetGraph": "ui-bc",
      "targetNode": "level-meter",
      "targetPort": "value",
      "edgeType": "data",
      "dataType": "f32",
      "latencyBudget": 16,
      "priority": "high",
      "metadata": {
        "label": "Audio Level to UI",
        "description": "Sends audio level from master output to UI level meter",
        "color": "#4CAF50"
      }
    },
    {
      "id": "ui-to-sequencer-play-command",
      "sourceGraph": "ui-bc",
      "sourceNode": "transport-controls",
      "sourcePort": "play-clicked",
      "targetGraph": "sequencer-bc",
      "targetNode": "transport",
      "targetPort": "play",
      "edgeType": "event",
      "dataType": "event",
      "latencyBudget": 10,
      "priority": "critical",
      "metadata": {
        "label": "Play Button to Sequencer",
        "description": "Triggers playback when user clicks play button"
      }
    }
  ]
}