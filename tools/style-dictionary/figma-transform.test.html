<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Figma Transform Tests</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      max-width: 1200px;
      margin: 2rem auto;
      padding: 0 1rem;
      background: #f5f5f5;
    }
    .test-suite {
      background: white;
      border-radius: 8px;
      padding: 1.5rem;
      margin-bottom: 1rem;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .test-case {
      padding: 0.75rem;
      margin: 0.5rem 0;
      border-radius: 4px;
      border-left: 4px solid #ccc;
    }
    .test-case.pass {
      background: #e8f5e9;
      border-left-color: #4caf50;
    }
    .test-case.fail {
      background: #ffebee;
      border-left-color: #f44336;
    }
    .test-name {
      font-weight: 600;
      margin-bottom: 0.25rem;
    }
    .test-result {
      font-family: 'Courier New', monospace;
      font-size: 0.875rem;
      color: #666;
    }
    .summary {
      font-size: 1.25rem;
      font-weight: 600;
      padding: 1rem;
      background: #2196f3;
      color: white;
      border-radius: 8px;
      text-align: center;
    }
    .error {
      color: #f44336;
      margin-top: 0.5rem;
      padding: 0.5rem;
      background: #ffebee;
      border-radius: 4px;
    }
  </style>
</head>
<body>
  <h1>Figma Transform Tests</h1>
  <div id="results"></div>
  <div id="summary"></div>

  <script type="module">
    import { utils, transformToFigma } from './figma-transform.js';

    const results = [];
    const resultsContainer = document.getElementById('results');
    const summaryContainer = document.getElementById('summary');

    function assert(condition, message) {
      if (!condition) {
        throw new Error(message);
      }
    }

    function assertDeepEqual(actual, expected, message) {
      const actualStr = JSON.stringify(actual);
      const expectedStr = JSON.stringify(expected);
      if (actualStr !== expectedStr) {
        throw new Error(`${message}\nExpected: ${expectedStr}\nActual: ${actualStr}`);
      }
    }

    function runTest(name, fn) {
      const testCase = document.createElement('div');
      testCase.className = 'test-case';
      
      const testName = document.createElement('div');
      testName.className = 'test-name';
      testName.textContent = name;
      testCase.appendChild(testName);
      
      try {
        fn();
        testCase.classList.add('pass');
        const result = document.createElement('div');
        result.className = 'test-result';
        result.textContent = '✓ Passed';
        testCase.appendChild(result);
        results.push({ name, pass: true });
      } catch (error) {
        testCase.classList.add('fail');
        const result = document.createElement('div');
        result.className = 'test-result';
        result.textContent = '✗ Failed';
        testCase.appendChild(result);
        
        const errorDiv = document.createElement('div');
        errorDiv.className = 'error';
        errorDiv.textContent = error.message;
        testCase.appendChild(errorDiv);
        
        results.push({ name, pass: false, error: error.message });
      }
      
      return testCase;
    }

    function runTestSuite(suiteName, tests) {
      const suite = document.createElement('div');
      suite.className = 'test-suite';
      
      const title = document.createElement('h2');
      title.textContent = suiteName;
      suite.appendChild(title);
      
      tests.forEach(({ name, fn }) => {
        suite.appendChild(runTest(name, fn));
      });
      
      resultsContainer.appendChild(suite);
    }

    // Color conversion tests
    runTestSuite('Color Conversion', [
      {
        name: 'hexToFigmaRgb - converts hex to RGB',
        fn: () => {
          const result = utils.hexToFigmaRgb('#FF0000');
          assertDeepEqual(result, { r: 1, g: 0, b: 0, a: 1 }, 'Red hex conversion');
        }
      },
      {
        name: 'hexToFigmaRgb - handles 8-digit hex with alpha',
        fn: () => {
          const result = utils.hexToFigmaRgb('#FF000080');
          assert(Math.abs(result.r - 1) < 0.01, 'Red channel');
          assert(Math.abs(result.g - 0) < 0.01, 'Green channel');
          assert(Math.abs(result.b - 0) < 0.01, 'Blue channel');
          assert(Math.abs(result.a - 0.5) < 0.01, 'Alpha channel');
        }
      },
      {
        name: 'rgbaToFigmaRgb - converts rgba string',
        fn: () => {
          const result = utils.rgbaToFigmaRgb('rgba(255, 0, 0, 0.5)');
          assert(Math.abs(result.r - 1) < 0.01, 'Red channel');
          assert(Math.abs(result.a - 0.5) < 0.01, 'Alpha channel');
        }
      },
      {
        name: 'colorToFigmaRgb - handles hex colors',
        fn: () => {
          const result = utils.colorToFigmaRgb('#00FF00');
          assertDeepEqual(result, { r: 0, g: 1, b: 0, a: 1 }, 'Green hex');
        }
      },
      {
        name: 'colorToFigmaRgb - handles rgba colors',
        fn: () => {
          const result = utils.colorToFigmaRgb('rgba(0, 0, 255, 1)');
          assert(Math.abs(result.b - 1) < 0.01, 'Blue channel');
        }
      }
    ]);

    // Value conversion tests
    runTestSuite('Value Conversion', [
      {
        name: 'pxToNumber - converts px string to number',
        fn: () => {
          assert(utils.pxToNumber('16px') === 16, 'Converts 16px');
          assert(utils.pxToNumber('24px') === 24, 'Converts 24px');
        }
      },
      {
        name: 'pxToNumber - handles numbers directly',
        fn: () => {
          assert(utils.pxToNumber(16) === 16, 'Passes through number');
        }
      }
    ]);

    // Token transformation tests
    runTestSuite('Token Transformation', [
      {
        name: 'transformColorToken - transforms color token',
        fn: () => {
          const token = {
            name: 'color-primary',
            value: '#FF0000',
            path: ['color', 'primary']
          };
          const result = utils.transformColorToken(token);
          assert(result.name === 'color-primary', 'Name preserved');
          assert(result.type === 'color', 'Type is color');
          assert(result.value.r === 1, 'Red channel correct');
        }
      },
      {
        name: 'transformTypographyToken - transforms typography token',
        fn: () => {
          const token = {
            name: 'typography-heading',
            value: {
              fontFamily: 'Inter',
              fontSize: '24px',
              fontWeight: '600',
              lineHeight: '1.5'
            },
            path: ['typography', 'heading']
          };
          const result = utils.transformTypographyToken(token);
          assert(result.name === 'typography-heading', 'Name preserved');
          assert(result.type === 'typography', 'Type is typography');
          assert(result.value.fontSize === 24, 'Font size converted');
          assert(result.value.fontWeight === 600, 'Font weight converted');
        }
      },
      {
        name: 'transformSpacingToken - transforms spacing token',
        fn: () => {
          const token = {
            name: 'spacing-md',
            value: '16px',
            path: ['spacing', 'md']
          };
          const result = utils.transformSpacingToken(token);
          assert(result.name === 'spacing-md', 'Name preserved');
          assert(result.type === 'spacing', 'Type is spacing');
          assert(result.value === 16, 'Value converted');
        }
      },
      {
        name: 'transformRadiusToken - transforms radius token',
        fn: () => {
          const token = {
            name: 'radius-sm',
            value: '4px',
            path: ['radius', 'sm']
          };
          const result = utils.transformRadiusToken(token);
          assert(result.name === 'radius-sm', 'Name preserved');
          assert(result.type === 'radius', 'Type is radius');
          assert(result.value === 4, 'Value converted');
        }
      }
    ]);

    // Full dictionary transformation test
    runTestSuite('Dictionary Transformation', [
      {
        name: 'transformToFigma - transforms complete dictionary',
        fn: () => {
          const dictionary = {
            allTokens: [
              {
                name: 'color-primary',
                value: '#FF0000',
                path: ['color', 'primary'],
                type: 'color'
              },
              {
                name: 'spacing-md',
                value: '16px',
                path: ['spacing', 'md'],
                type: 'spacing'
              }
            ]
          };
          const result = transformToFigma(dictionary);
          assert(result.version === '1.0', 'Has version');
          assert(result.tokens.colors.length === 1, 'Has color token');
          assert(result.tokens.spacing.length === 1, 'Has spacing token');
        }
      }
    ]);

    // Display summary
    const passed = results.filter(r => r.pass).length;
    const total = results.length;
    summaryContainer.innerHTML = `
      <div class="summary">
        Tests: ${passed}/${total} passed
        ${passed === total ? '✓ All tests passed!' : '✗ Some tests failed'}
      </div>
    `;
  </script>
</body>
</html>