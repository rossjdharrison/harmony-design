# Harmony Design System

A comprehensive design system for building audio production interfaces with performance-first architecture.

## Overview

The Harmony Design System provides tokens, components, and patterns for creating consistent, accessible, and performant user interfaces for digital audio workstations and music production tools.

## Design Tokens

Design tokens are the foundational design decisions of the system, stored as JSON files and transformed for various platforms.

### Color Tokens

**File**: [tokens/colors.json](tokens/colors.json)

The color palette defines brand identity and semantic colors across the system:

- **Brand Colors**: Primary (sky blue), Secondary (purple), Accent (magenta)
- **Semantic Colors**: Success (green), Warning (amber), Error (red), Info (blue)
- **Neutral Colors**: Grayscale palette for text, borders, and backgrounds

Each color family provides a 50-900 scale for flexible theming and accessibility compliance. The base color (500) represents the main brand or semantic meaning, with lighter shades (50-400) for backgrounds and darker shades (600-900) for text and emphasis.

**Usage in Components**:
```javascript
// Reference tokens via CSS custom properties (generated by token transform pipeline)
element.style.backgroundColor = 'var(--color-brand-primary-500)';
```

**Token Schema**: All tokens validate against [tokens/token-schema.json](tokens/token-schema.json)

**Related Systems**:
- [Token Validator](tokens/token-validator.js) - Runtime validation
- [Token Loader](tokens/token-loader.js) - Dynamic token loading
- [Token Transform Pipeline](tokens/token-transform-pipeline.js) - Multi-platform output
- [Token Watcher](tokens/token-watcher.js) - Hot-reload during development

### Token Architecture

Tokens follow a hierarchical structure:
1. **Raw Tokens** - Source of truth in JSON format
2. **Transformed Tokens** - Platform-specific outputs (CSS, SCSS, JS)
3. **Runtime Tokens** - Dynamically loaded and validated

**Validation Flow**:
Raw JSON → Schema Validation → Transform → Platform Output

**Development Workflow**:
1. Edit tokens in JSON files
2. Token watcher detects changes
3. Validation runs automatically
4. Transform pipeline generates outputs
5. Components hot-reload with new values

## Components

Components are built as Web Components with shadow DOM encapsulation.

### Primitives

Basic UI elements like buttons, inputs, and icons.

**Example**: [components/controls/harmony-icon.js](components/controls/harmony-icon.js)

### Controls

Interactive audio controls like faders, knobs, and meters.

**Example**: [components/controls/harmony-fader.js](components/controls/harmony-fader.js)

### Composites

Complex components combining multiple primitives.

**Examples**:
- [components/composites/clip/clip.js](components/composites/clip/clip.js)
- [components/composites/transport-bar/transport-bar.js](components/composites/transport-bar/transport-bar.js)

### Organisms

Full-featured application sections.

## Architecture Patterns

### Event-Driven Communication

Components publish events, never call bounded contexts directly.

**Pattern**:
```
User Action → Component Event → EventBus → Bounded Context → Result Event
```

**Debugging**: [EventBusComponent](components/event-bus-debugger.js) (Ctrl+Shift+E)

### Bounded Contexts

Core logic implemented in Rust/WASM for performance.

**Location**: [bounded-contexts/](bounded-contexts/)

**Schema-Driven Development**:
1. Define schema in [harmony-schemas](harmony-schemas/)
2. Run codegen to generate Rust types
3. Implement business logic
4. Compile to WASM

### Error Handling

[Error Boundary Component](components/error-boundary/error-boundary.js) catches and displays component errors gracefully.

## Performance Budgets

- **Render**: Maximum 16ms per frame (60fps)
- **Memory**: Maximum 50MB WASM heap
- **Load**: Maximum 200ms initial load
- **Audio Latency**: Maximum 10ms end-to-end

## Testing

All components must be tested in Chrome before completion:
- Default, hover, focus, active, disabled states
- Error, loading, empty states (where applicable)
- Performance profiling for animations (60fps target)

## Development Tools

- **Component Graph Event Log**: [components/dev-tools/component-graph-event-log.js](components/dev-tools/component-graph-event-log.js)
- **Color Contrast Validator**: [components/color-contrast-validator.js](components/color-contrast-validator.js)
- **Theme Switcher**: [components/theme-switcher/](components/theme-switcher/)

## Figma Integration

Design tokens sync bidirectionally with Figma:
- **Export**: Figma → JSON tokens
- **Import**: JSON tokens → Figma styles

**Related**: [tools/figma-token-sync.js](tools/figma-token-sync.js)

## Style Dictionary

Transform tokens for multiple platforms using Style Dictionary.

**Configuration**: [tools/style-dictionary-config.js](tools/style-dictionary-config.js)

**Outputs**:
- CSS custom properties
- SCSS variables
- JavaScript modules
- JSON for runtime

## Documentation Standards

- Written in B1-level English (clear, simple)
- Code lives in files, not documentation
- Mutual references between docs and code
- Logical sections per concern
- Concise but friendly tone

## Contributing

1. Check existing structure before creating files
2. Follow established patterns
3. Validate against quality gates
4. Update this documentation
5. Test in Chrome before completion
6. Push changes to remote

## Quality Gates

All changes must pass:
- Schema validation
- Bundle size checks
- Performance budgets
- Composition validation
- CI build pipeline

**Configuration**: [.github/workflows/](. github/workflows/)