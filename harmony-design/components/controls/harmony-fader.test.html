<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HarmonyFader Control - Test Page</title>
  <style>
    body {
      margin: 0;
      padding: 20px;
      background: #1a1a1a;
      color: #e0e0e0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }

    .test-container {
      max-width: 1200px;
      margin: 0 auto;
    }

    h1 {
      color: #ffffff;
      margin-bottom: 10px;
    }

    .test-description {
      color: #b0b0b0;
      margin-bottom: 30px;
      line-height: 1.6;
    }

    .test-section {
      margin-bottom: 40px;
      padding: 20px;
      background: #2a2a2a;
      border-radius: 8px;
    }

    .test-section h2 {
      margin-top: 0;
      color: #4a9eff;
      font-size: 18px;
    }

    .fader-group {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
      padding: 20px;
      background: #333;
      border-radius: 4px;
    }

    .info-panel {
      margin-top: 20px;
      padding: 15px;
      background: #222;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
    }

    .info-panel h3 {
      margin-top: 0;
      color: #4a9eff;
      font-size: 14px;
    }

    .event-log {
      max-height: 200px;
      overflow-y: auto;
      padding: 10px;
      background: #1a1a1a;
      border-radius: 4px;
      margin-top: 10px;
    }

    .event-entry {
      padding: 5px;
      margin-bottom: 5px;
      border-left: 3px solid #4a9eff;
      padding-left: 10px;
    }

    .event-time {
      color: #888;
      font-size: 10px;
    }

    .controls {
      margin-top: 15px;
      display: flex;
      gap: 10px;
    }

    button {
      padding: 8px 16px;
      background: #4a9eff;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
    }

    button:hover {
      background: #3a8eef;
    }

    button:active {
      background: #2a7edf;
    }

    .status-indicator {
      display: inline-block;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      margin-right: 5px;
    }

    .status-indicator.active {
      background: #4ade80;
    }

    .status-indicator.inactive {
      background: #666;
    }
  </style>
</head>
<body>
  <div class="test-container">
    <h1>üéöÔ∏è HarmonyFader Control - Test Page</h1>
    <p class="test-description">
      Testing the HarmonyFader control component with various configurations.
      This component wraps the fader primitive and adds label, value display, and event handling.
    </p>

    <!-- Test Section 1: Basic Faders -->
    <div class="test-section">
      <h2>Basic Faders</h2>
      <div class="fader-group">
        <harmony-fader 
          label="Master" 
          value="75" 
          unit="dB"
          channel-id="master">
        </harmony-fader>

        <harmony-fader 
          label="Track 1" 
          value="60" 
          unit="dB"
          channel-id="track1">
        </harmony-fader>

        <harmony-fader 
          label="Track 2" 
          value="50" 
          unit="dB"
          channel-id="track2">
        </harmony-fader>

        <harmony-fader 
          label="FX Send" 
          value="25" 
          unit="%"
          channel-id="fx-send">
        </harmony-fader>
      </div>
    </div>

    <!-- Test Section 2: Different Ranges -->
    <div class="test-section">
      <h2>Different Value Ranges</h2>
      <div class="fader-group">
        <harmony-fader 
          label="Volume (0-100)" 
          value="50" 
          min="0" 
          max="100"
          unit="%"
          channel-id="vol1">
        </harmony-fader>

        <harmony-fader 
          label="Gain (-12 to +12)" 
          value="0" 
          min="-12" 
          max="12"
          unit="dB"
          channel-id="gain1">
        </harmony-fader>

        <harmony-fader 
          label="Pan (-50 to +50)" 
          value="0" 
          min="-50" 
          max="50"
          channel-id="pan1">
        </harmony-fader>
      </div>
    </div>

    <!-- Test Section 3: States -->
    <div class="test-section">
      <h2>Component States</h2>
      <div class="fader-group">
        <harmony-fader 
          label="Default" 
          value="75" 
          unit="dB"
          channel-id="state-default">
        </harmony-fader>

        <harmony-fader 
          label="Disabled" 
          value="50" 
          unit="dB"
          disabled
          channel-id="state-disabled">
        </harmony-fader>

        <harmony-fader 
          label="No Label" 
          value="80" 
          unit="dB"
          channel-id="state-no-label">
        </harmony-fader>

        <harmony-fader 
          label="No Unit" 
          value="65"
          channel-id="state-no-unit">
        </harmony-fader>
      </div>
    </div>

    <!-- Test Section 4: Programmatic Control -->
    <div class="test-section">
      <h2>Programmatic Control</h2>
      <div class="fader-group">
        <harmony-fader 
          id="programmatic-fader"
          label="Controlled" 
          value="50" 
          unit="dB"
          channel-id="programmatic">
        </harmony-fader>
      </div>
      <div class="controls">
        <button onclick="setFaderValue(0)">Set to 0</button>
        <button onclick="setFaderValue(50)">Set to 50</button>
        <button onclick="setFaderValue(100)">Set to 100</button>
        <button onclick="animateFader()">Animate</button>
      </div>
    </div>

    <!-- Event Monitor -->
    <div class="test-section">
      <h2>Event Monitor</h2>
      <div class="info-panel">
        <h3>
          <span class="status-indicator" id="event-status"></span>
          Event Log
        </h3>
        <div class="event-log" id="event-log">
          <div style="color: #888;">Waiting for events...</div>
        </div>
        <div class="controls">
          <button onclick="clearEventLog()">Clear Log</button>
        </div>
      </div>
    </div>

    <!-- Performance Monitor -->
    <div class="test-section">
      <h2>Performance Monitor</h2>
      <div class="info-panel">
        <div>Frame Time: <span id="frame-time">-</span></div>
        <div>Memory: <span id="memory-usage">-</span></div>
        <div>Event Count: <span id="event-count">0</span></div>
      </div>
    </div>
  </div>

  <!-- Load primitive first (assuming it exists) -->
  <script src="../primitives/harmony-fader-primitive.js" type="module"></script>
  
  <!-- Load the control component -->
  <script src="./harmony-fader.js" type="module"></script>

  <script>
    let eventCount = 0;
    let lastFrameTime = performance.now();

    // Add event listeners to all faders
    document.addEventListener('DOMContentLoaded', () => {
      const faders = document.querySelectorAll('harmony-fader');
      
      faders.forEach(fader => {
        fader.addEventListener('fader-changed', (e) => {
          logEvent('fader-changed', e.detail);
          eventCount++;
          updateEventCount();
        });

        fader.addEventListener('fader-input', (e) => {
          logEvent('fader-input', e.detail, true);
        });
      });

      // Start performance monitoring
      startPerformanceMonitoring();
    });

    function logEvent(type, detail, isInput = false) {
      const eventLog = document.getElementById('event-log');
      const statusIndicator = document.getElementById('event-status');
      
      // Clear "waiting" message
      if (eventLog.children.length === 1 && eventLog.children[0].textContent.includes('Waiting')) {
        eventLog.innerHTML = '';
      }

      // Only log every 10th input event to avoid spam
      if (isInput && Math.random() > 0.1) return;

      const entry = document.createElement('div');
      entry.className = 'event-entry';
      
      const time = new Date().toLocaleTimeString();
      const typeLabel = isInput ? 'input' : 'changed';
      
      entry.innerHTML = `
        <div class="event-time">${time}</div>
        <div><strong>${type}</strong> (${typeLabel})</div>
        <div>Channel: ${detail.channelId || 'unknown'}</div>
        <div>Value: ${detail.value?.toFixed(1) || '-'}</div>
      `;
      
      eventLog.insertBefore(entry, eventLog.firstChild);
      
      // Keep only last 20 events
      while (eventLog.children.length > 20) {
        eventLog.removeChild(eventLog.lastChild);
      }

      // Flash status indicator
      statusIndicator.className = 'status-indicator active';
      setTimeout(() => {
        statusIndicator.className = 'status-indicator inactive';
      }, 100);
    }

    function clearEventLog() {
      const eventLog = document.getElementById('event-log');
      eventLog.innerHTML = '<div style="color: #888;">Log cleared</div>';
      eventCount = 0;
      updateEventCount();
    }

    function updateEventCount() {
      document.getElementById('event-count').textContent = eventCount;
    }

    function setFaderValue(value) {
      const fader = document.getElementById('programmatic-fader');
      if (fader) {
        fader.value = value;
      }
    }

    function animateFader() {
      const fader = document.getElementById('programmatic-fader');
      if (!fader) return;

      let value = 0;
      const interval = setInterval(() => {
        value += 2;
        fader.value = value;
        
        if (value >= 100) {
          clearInterval(interval);
        }
      }, 50);
    }

    function startPerformanceMonitoring() {
      function updateStats() {
        const now = performance.now();
        const frameTime = now - lastFrameTime;
        lastFrameTime = now;

        document.getElementById('frame-time').textContent = 
          `${frameTime.toFixed(2)}ms ${frameTime > 16 ? '‚ö†Ô∏è' : '‚úì'}`;

        if (performance.memory) {
          const usedMB = (performance.memory.usedJSHeapSize / 1024 / 1024).toFixed(2);
          document.getElementById('memory-usage').textContent = 
            `${usedMB}MB ${usedMB > 50 ? '‚ö†Ô∏è' : '‚úì'}`;
        } else {
          document.getElementById('memory-usage').textContent = 'N/A (Chrome only)';
        }

        requestAnimationFrame(updateStats);
      }

      requestAnimationFrame(updateStats);
    }

    // Mock EventBus for testing
    if (typeof window.EventBus === 'undefined') {
      window.EventBus = {
        publish: (type, payload) => {
          console.log('[EventBus Mock]', type, payload);
        }
      };
    }
  </script>
</body>
</html>